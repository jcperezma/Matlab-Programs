function [ a4 ] = ORW3( a2 )
% Computes the  improved Orthotropic  Fittedclosure approximation
% the coefficients are from Chung and Kwon (2001) 
% find eginevalues of a2
%lambda = eig(a2);


a4 =zeros(3,3,3,3);


C= [-0.1480648093  0.8084618453  0.3722003446  0.7765597096 -1.3431772379  -1.7366749542 0.8895946393 1.7367571741 -0.0324756095  0.6631716575;...
    -0.2106349673  0.9092350296 -1.2840654776  1.1104441966  0.1260059291  -2.537563231  1.9988098293 1.4863151577  0.5856304774 -0.0756740034; ...
     0.4868019601  0.5776328438 -2.2462007509  0.4605743789 -1.9088154281  -4.8900459209 4.0544348937 3.8542602127  1.1817992322  0.9512305286];

% C = [  0.636256797 -1.872662964 -4.479708732 11.95895623 3.844596924 11.34209243 -10.95826261 -20.72779947 ...
%         -2.116232145 -12.38756329 9.815983897 3.479015106 11.74929112 0.508041387 4.883665978 ;...
%         0.636256797 -3.315272297 -3.037099398 11.8273286 6.881539521 8.436777 -15.91206672 -15.15158726 ...
%         -6.487289336 -8.638914193 9.325203435 7.746837517 7.481468706 2.284765316 3.597722511 ; ...
%         2.740532896 -9.121965098 -12.2570587 34.31990189 13.82946991 25.86847553 -37.7029118 -50.27564319 ...
%         -10.88017611 -26.96369152 27.33467981 15.26506861 26.1134914 3.432138403 10.61174181];
lambda= [a2(1,1) a2(2,2) a2(3,3)  ] ;

vect =  [1; lambda(1); lambda(1)^2 ; lambda(2);lambda(2)^2; lambda(1)*lambda(2);...
          lambda(1)^2*lambda(2); lambda(2)^2*lambda(1);lambda(1)^3;lambda(2)^3 ] ;
 

%Compute A11 A22 and A33 of the othotropic tensor
%A = C * [1 ; a2(1,1) ; a2(1,1)*a2(1,1) ; a2(2,2) ; a2(2,2)*a2(2,2) ; a2(1,1)*a2(2,2) ];
A = C * vect;
A2 = [0 1 1; 1 0 1; 1 1 0 ] \ ( [a2(1,1);a2(2,2);a2(3,3)  ] - A  );

% form the compacted orthotropic tensor
A_mn = [  A(1) A2(3) A2(2)   0      0    0; ...
    A2(3)  A(2) A2(1)   0      0    0 ;...
    A2(2) A2(1)  A(3)   0      0    0 ;...
    0     0     0    A2(1)    0    0 ;...
    0     0     0      0    A2(2)  0; ...
    0     0     0      0      0   A2(3)];

for i = 1 :3
    for j = 1 :3
        switch i+j
            case 2
                m = 1;
            case 4
                if i == 1 || i== 3
                    m = 5;
                else
                    m = 2;
                end
            case 6
                m = 3;
            case 5
                m = 4;
            case 3
                m = 6;
        end
        for k = 1 :3
            for l =1 :3
                switch k+l
                    case 2
                        n = 1;
                    case 4
                        if k == 1 || k== 3
                            n = 5;
                        else
                            n = 2;
                        end
                    case 6
                        n = 3;
                    case 5
                        n = 4;
                    case 3
                        n = 6;
                end              
                a4(i,j,k,l) = A_mn(m,n);     
            end
        end
    end
end



end

